

@if (Web.Models.Autorizacion.TienePermiso(BL.RolesMenu.menu_curso_todo))
{
    <div class="row">
        <div class="col s12 m12 l12">
            <div id="bordered-table" class="card card card-default scrollspy">
                <div class="card-content">
                    <div class="card-title">
                        <div class="row">
                            <div class="col s8 m6 l10">
                                <h4 class="card-title">GESTIONAR CURSOS</h4>
                            </div>
                            <div class="col s4 m6 l2">
                                <a class="btn-small blue right" href="@Url.Action("Mantener","Curso", new { id=0})"><i class="material-icons left">add</i>Nuevo</a>
                            </div>
                        </div>
                    </div>

                    <div>
                        <input type="text" name="denominacion" id="denominacion" placeholder="BUSCAR CURSO POR NOMBRE" />
                    </div>

                    <div class="row">
                        <div class="col s12">
                        </div>
                        <div class="col s12">
                            <table class="bordered">
                                <thead>
                                    <tr>
                                        <th>Id</th>
                                        <th>Codigo</th>
                                        <th>Denominacion</th>
                                        <th>Creditos</th>
                                        <th>Especialidad</th>
                                        <th>Acciones</th>

                                    </tr>
                                </thead>
                                <tbody id="tbd_cursos">
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="row">
        <div class="col s12 m12 l12">
            <div id="bordered-table" class="card card card-default scrollspy z-depth-0">
                <div class="col-md-12 center text-center">

                    <div id="Encontrado">
                        <span>
                            <label id="TotalRegistros"></label> registros encontrados
                        </span>
                        <span>&nbsp;|&nbsp;</span>
                        <span>
                            Página <label id="PaginaActual"></label> de
                            <label id="TotalPaginas"></label>
                        </span>
                    </div>
                    <div class="row" id="NoEncontrado">
                        <span>&nbsp;|&nbsp;</span>
                        <span>No hay resultados de la búsqueda</span>
                        <span>&nbsp;|&nbsp;</span>
                    </div>

                    <div>
                        <button class="btn btn-small blue" id="inicio_cursos"><<</button>
                        <span></span>
                        <button class="btn btn-small blue" id="anterior_cursos">Anterior</button>

                        <button class="btn btn-small blue" id="siguiente_cursos">Siguiente</button>
                        <span></span>
                        <button class="btn btn-small blue" id="ultimo_cursos">>></button>
                    </div>

                </div>
            </div>
        </div>
    </div>

    <div class="row">
        <p style="color:transparent">Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum</p>
    </div>

}


@section scripts{

}

<script src="~/Scripts/jquery-3.4.1.min.js" type="text/javascript"></script>
<script src="~/Scripts/paginador/paginador.js"></script>

<script>

    var currentPage = 1;
    var pageCount = 0;

    $(document).ready(function () {
        //START PAGINATION 'CURSO'
        paginadorFuncCursos($("#denominacion").val(),currentPage);

        $("#inicio_cursos").click(function () {
            paginadorFuncCursos($("#denominacion").val(),1);
        });
        $("#siguiente_cursos").click(function () {
            paginadorFuncCursos($("#denominacion").val(),currentPage + 1);
        });
        $("#ultimo_cursos").click(function () {
            paginadorFuncCursos($("#denominacion").val(),pageCount);
        });
        $("#anterior_cursos").click(function () {
            paginadorFuncCursos($("#denominacion").val(),currentPage - 1)
        });
    });

    //Filter Course denomination
    $("#denominacion").on('input', function () {
        paginadorFuncCursos($("#denominacion").val(), 1)
    });

    //PAGINATION 'CURSOS'
    var paginadorFuncCursos = function (denominacion, pagina) {
        var envio = {
            denominacion: denominacion,
            pagina: pagina > 0 ? pagina : 1
        }
        $.ajax({
            url: '@Url.Action("Tabla","Curso")',
            data: JSON.stringify(envio),
            type: 'POST',
            async: false,//this makes the ajax-call blocking
            contentType: 'application/json;charset=UTF-8',
            dataType: 'json',
            success: function (rm) {
                var Listado = rm.result.Listado;
                var PaginaActual = rm.result.PaginaActual;
                var RegistrosPorPagina = rm.result.RegistrosPorPagina;
                var TotalPaginas = rm.result.TotalPaginas;
                var TotalRegistros = rm.result.TotalRegistros;

                pageCount = rm.result.TotalPaginas;
                currentPage = rm.result.PaginaActual;


                if (Listado.length > 0) {
                    $("#NoEncontrado").hide();
                    $("#TotalRegistros").html(TotalRegistros);
                    $("#PaginaActual").html(PaginaActual);
                    $("#TotalPaginas").html(TotalPaginas);
                    $("#tbd_cursos").empty();
                    fillPaginatorCursos("#tbd_cursos", Listado)
                }
                else {
                    $("#Encontrado").hide();
                    $("#NoEncontrado").show();
                    $("#tbd_cursos").empty();
                }

                deshabilitarBotones(rm.result, 'cursos')
            }
        });
    }

    function fillPaginatorCursos(id, list) {
        list.forEach(function (item, index) {
            const button = `<td style="padding:0">
                                <a href="Curso/Mantener/${item.Id}"><i class="material-icons">edit</i></a>
                                <a href="Curso/Eliminar/${item.Id}"><i class="material-icons">delete</i></a>
                            </td>
                            `
            fillTable(id,
                { keyword: 'curso', id: item.Id },
                item.Id,
                item.Codigo,
                item.Denominacion,
                item.Credito,
                item.NombreEspecialidad,
                { isExtra: true, value: button }
            )

        });

    }


</script>