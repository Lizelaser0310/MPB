
@{
    Web.Models.Paginador<DA.CajaDiario> ListadoCajasAsignadas = ViewBag.ListadoCajasAsignadas;
    Web.Models.Paginador<DA.CajaDiario> ListadoCajasDiario = ViewBag.ListadoCajasDiario;
    decimal monto = ViewBag.MontoTotal;
}

<style>
    #modal1{
        position: absolute;
        width:800px;
    }
    #modal2{
        position:absolute;
        width:400px;
    }
    .modal-content{
        background-color: #A7BBCE;
    }
    .modal-footer{
        background-color: #E5EAEE;
    }
    .cabecera{
        background-color: #A7BBCE;
    }
    .collapsible-header{
        background-color: #E0EAF4;
        font-weight: bold;
    }

</style>

<div class="row" id="principal">
    <div class="row" id="contenedor">
        <div class="row">
            <div class="col s12 m12 l12">
                <div class="card-content">
                    <ul class="collapsible">
                        <li class="active">
                            <div class="collapsible-header"><i class="material-icons">business</i>CAJAS ASIGNADAS</div>
                            <div class="collapsible-body">
                                <div class="row">
                                    <div class="col s12 m12">
                                        <table class="bordered">
                                            <thead>
                                                <tr>
                                                    <th>DiarioId</th>
                                                    <th>CAJA</th>
                                                    <th>CAJERO</th>
                                                    <th>FECHA INICIO</th>
                                                    <th>FECHA FIN</th>
                                                    <th>SALDO INICIAL</th>
                                                    <th>ENTRADAS</th>
                                                    <th>SALIDAS</th>
                                                    <th>SALDO FINAL</th>
                                                    <th>CIERRE</th>
                                                    <th hidden>BOVEDA</th>
                                                </tr>
                                            </thead>
                                            <tbody id="tbd_Asignadas">
                                                @foreach (var item in ListadoCajasAsignadas.Listado)
                                                {
                                                    <tr>
                                                        <td style="padding:0">@item.Id</td>
                                                        <td style="padding: 0 ">@item.Caja.Denominacion</td>
                                                        <td style="padding:0">@item.Usuario.Nombre</td>
                                                        <td style="padding:0">@item.FechaInicio</td>
                                                        <td style="padding:0">@item.FechaFin</td>
                                                        <td style="padding:0">@item.SaldoInicial</td>
                                                        <td style="padding:0">@item.Entradas</td>
                                                        <td style="padding:0">@item.Salidas</td>
                                                        <td class="Final" style="padding:0">@item.SaldoFinal</td>
                                                        <td style="padding:0">
                                                            @if (item.IndCierre)
                                                            {
                                                                <text>SI</text>
                                                            }
                                                            else
                                                            {
                                                                <text>NO</text>
                                                            }
                                                        </td>
                                                        <td style="padding:0" hidden>
                                                            @if (item.IndBoveda)
                                                            {
                                                                <text>SI</text>
                                                            }
                                                            else
                                                            {
                                                                <text>NO</text>
                                                            }
                                                        </td>
                                                    </tr>
                                                }

                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col s12 m12 l12">
                                        <div id="bordered-table" class="card card card-default scrollspy">
                                            <div class="col-md-12 center text-center">
                                                @if (ListadoCajasAsignadas.Listado.Count() > 0)
                                                {
                                                    <span>
                                                        <strong>@ListadoCajasAsignadas.TotalRegistros</strong> registros encontrados
                                                    </span>
                                                    <span>&nbsp;|&nbsp;</span>
                                                    <span>
                                                        Página <strong>@(ListadoCajasAsignadas.PaginaActual)</strong> de
                                                        <strong>@ListadoCajasAsignadas.TotalPaginas</strong>
                                                    </span>
                                                    <span>&nbsp;|&nbsp;</span>
                                                }
                                                else
                                                {
                                                    <span>No hay resultados para esta búsqueda</span>
                                                    <span>&nbsp;|&nbsp;</span>
                                                }

                                                @if (ListadoCajasAsignadas.PaginaActual > 1)
                                                {
                                                    @Html.ActionLink("<<", "Index", new { pagina = 1 },
                                                                    new { @class = "btn btn-sm btn-default" })
                                                    <span></span>
                                                    @Html.ActionLink("Anterior", "Index", new { pagina = ListadoCajasAsignadas.PaginaActual - 1 },
                                                                    new { @class = "btn btn-sm btn-default" })
                                                }
                                                else
                                                {
                                                    @Html.ActionLink("<<", "Index", new { pagina = 1 },
                                                                    new { @class = "btn btn-sm btn-default disabled" })
                                                    <span></span>
                                                    @Html.ActionLink("Anterior", "Index", new { pagina = 1 },
                                                                    new { @class = "btn btn-sm btn-default disabled" })
                                                }
                                                <span></span>
                                                @if (ListadoCajasAsignadas.PaginaActual < ListadoCajasAsignadas.TotalPaginas)
                                                {
                                                    @Html.ActionLink("Siguiente", "Index", new { pagina = ListadoCajasAsignadas.PaginaActual + 1 },
                                                                    new { @class = "btn btn-sm btn-default" })
                                                    <span></span>
                                                    @Html.ActionLink(">>", "Index", new { pagina = ListadoCajasAsignadas.TotalPaginas },
                                                                    new { @class = "btn btn-sm btn-default" })
                                                }
                                                else
                                                {
                                                    @Html.ActionLink("Siguiente", "Index", new { pagina = ListadoCajasAsignadas.TotalPaginas - 1 },
                                                                    new { @class = "btn btn-sm btn-default disabled" })
                                                    <span></span>
                                                    @Html.ActionLink(">>", "Index", new { pagina = ListadoCajasAsignadas.TotalPaginas },
                                                                    new { @class = "btn btn-sm btn-default disabled" })
                                                }
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </li>
                    </ul>
                    <ul>
                        <li>
                            <div>
                                <button data-target="modal1" class="btn modal-trigger btn-small blue left" id="asignar_caja">ASIGNAR CAJA</button>
                                &nbsp;
                                <button data-target="modal2" class="btn modal-trigger btn-small blue right" id="cerrar_caja" disabled>CERRAR CAJAS</button>
                            </div>
                        </li>
                    </ul>
                </div>
            </div>
        </div>

        <!--Start Modals-->
        <!-- Modal Structure Asignar Caja -->
        <div id="modal1" class="modal center-align">
            <div class="col s12 cabecera">
                <h5>Asignar Caja</h5>
            </div>
            <div class="modal-content">

                <div class="col s12 ">
                    <div id="validations" class="card card-tabs">
                        <div class="card-content">
                            <div class="form-group">
                                <div class="row">
                                    <div class="input-field col s12 m6">
                                        @Html.DropDownList("CajasDisponibles", ViewBag.CajasDisponibles as SelectList, "SELECCIONE CAJA", htmlAttributes: new { @class = "browser-default" })
                                    </div>
                                    <div class="input-field col s12 m6">
                                        @Html.DropDownList("UsuariosDisponibles", ViewBag.UsuariosDisponibles as SelectList, "SELECCIONE USUARIO", htmlAttributes: new { @class = "browser-default" })
                                    </div>
                                    <div class="input-field col s12 m6">
                                        <label for="inicial" style="font-weight:bold">SALDO INICIAL*</label>
                                        <input type="number" step="any" name="inicial" id="inicial" value="0.00" required />
                                    </div>
                                    <div class="input-field col s12 m6">
                                        <label for="monto" style="font-weight:bold">MONTO TOTAL DE BÓVEDA:</label>
                                        <input type="text" name="monto" id="monto" value="@monto" readonly />
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <a href="#principal" class="modal-close btn-small blue right" style="margin-right:30px;" id="asignar">Guardar</a>
                &nbsp;
                <a href="#principal" class="modal-close btn-small blue-grey left" style="margin-left:30px;">Cancelar</a>
            </div>
        </div>

        <!-- Modal Structure Cerrar Cajas -->
        <div id="modal2" class="modal center-align">
            <div class="col s12 cabecera">
                <h5>MPB</h5>
            </div>
            <div class="modal-content">

                <div class="col s12 ">
                    <div id="validations" class="card card-tabs">
                        <div class="card-content">
                            <p>¿DESEA CERRAR LAS CAJAS?</p>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <a href="#principal" class="modal-close btn-small blue right" style="margin-right:30px;" id="cerrar">Guardar</a>
                &nbsp;
                <a href="#principal" class="modal-close btn-small blue-grey left" style="margin-left:30px;">Cancelar</a>
            </div>
        </div>

        <!--Final Modal-->
        <div class="row">
            <div class="col s12 m12 l12">
                <div class="card-content">
                    <ul class="collapsible">
                        <li class="active">
                            <div class="collapsible-header"><i class="material-icons">business</i>SALDOS CAJA DIARIO</div>
                            <div class="collapsible-body">
                                <div class="row">
                                    <div class="col s12 m12">
                                        <table class="bordered">
                                            <thead>
                                                <tr>
                                                    <th>N°</th>
                                                    <th>CAJA</th>
                                                    <th>RESPONSABLE</th>
                                                    <th>SALDO INICIAL</th>
                                                    <th>SALDO FINAL</th>
                                                    <th>F.INICIO</th>
                                                    <th>F.FIN</th>
                                                    <th>CERRADO</th>
                                                    <th>BOVEDA</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                @foreach (var item in ListadoCajasDiario.Listado)
                                                {
                                                    var aux = item.IndBoveda;
                                                    string Ind = "td" + aux;
                                                    <tr>
                                                        <td style="padding:0">@item.Id</td>
                                                        <td style="padding:0">@item.Caja.Denominacion</td>
                                                        <td style="padding:0">@item.Usuario.Nombre </td>
                                                        <td style="padding:0">@item.SaldoInicial</td>
                                                        <td style="padding:0">@item.SaldoFinal</td>
                                                        <td style="padding:0">@item.FechaInicio</td>
                                                        <td style="padding:0">@item.FechaFin</td>
                                                        <td style="padding:0">
                                                            @if (item.IndCierre)
                                                            {
                                                                <text>SI</text>
                                                            }
                                                            else
                                                            {
                                                                <text>NO</text>
                                                            }
                                                        </td>
                                                        <td style="padding:0" class="@Ind">
                                                            @if (item.IndBoveda)
                                                            {
                                                                <text>SI</text>
                                                            }
                                                            else
                                                            {
                                                                <text>NO</text>
                                                            }
                                                        </td>
                                                    </tr>
                                                }

                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col s12 m12 l12">
                                        <div id="bordered-table" class="card card card-default scrollspy">
                                            <div class="col-md-12 center text-center">
                                                @if (ListadoCajasDiario.Listado.Count() > 0)
                                                {
                                                    <span>
                                                        <strong>@ListadoCajasDiario.TotalRegistros</strong> registros encontrados
                                                    </span>
                                                    <span>&nbsp;|&nbsp;</span>
                                                    <span>
                                                        Página <strong>@(ListadoCajasDiario.PaginaActual)</strong> de
                                                        <strong>@ListadoCajasDiario.TotalPaginas</strong>
                                                    </span>
                                                    <span>&nbsp;|&nbsp;</span>
                                                }
                                                else
                                                {
                                                    <span>No hay resultados para esta búsqueda</span>
                                                    <span>&nbsp;|&nbsp;</span>
                                                }

                                                @if (ListadoCajasDiario.PaginaActual > 1)
                                                {
                                                    @Html.ActionLink("<<", "Index", new { pagina = 1 },
                                                                    new { @class = "btn btn-sm btn-default" })
                                                    <span></span>
                                                    @Html.ActionLink("Anterior", "Index", new { pagina = ListadoCajasDiario.PaginaActual - 1 },
                                                                    new { @class = "btn btn-sm btn-default" })
                                                }
                                                else
                                                {
                                                    @Html.ActionLink("<<", "Index", new { pagina = 1 },
                                                                    new { @class = "btn btn-sm btn-default disabled" })
                                                    <span></span>
                                                    @Html.ActionLink("Anterior", "Index", new { pagina = 1 },
                                                                    new { @class = "btn btn-sm btn-default disabled" })
                                                }
                                                <span></span>
                                                @if (ListadoCajasDiario.PaginaActual < ListadoCajasDiario.TotalPaginas)
                                                {
                                                    @Html.ActionLink("Siguiente", "Index", new { pagina = ListadoCajasDiario.PaginaActual + 1 },
                                                                    new { @class = "btn btn-sm btn-default" })
                                                    <span></span>
                                                    @Html.ActionLink(">>", "Index", new { pagina = ListadoCajasDiario.TotalPaginas },
                                                                    new { @class = "btn btn-sm btn-default" })
                                                }
                                                else
                                                {
                                                    @Html.ActionLink("Siguiente", "Index", new { pagina = ListadoCajasDiario.TotalPaginas - 1 },
                                                                    new { @class = "btn btn-sm btn-default disabled" })
                                                    <span></span>
                                                    @Html.ActionLink(">>", "Index", new { pagina = ListadoCajasDiario.TotalPaginas },
                                                                    new { @class = "btn btn-sm btn-default disabled" })
                                                }
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col s6">
                <div class="card-content">
                    <ul class="collapsible">
                        <li class="active">
                            <div class="collapsible-header"><i class="material-icons">delete_outline</i>ANULAR MOVIMIENTO DE CAJA</div>
                            <div class="collapsible-body">
                                <div class="row">
                                    <div class="col s12 m12">
                                        <div class="form-group">
                                            <div class="row">
                                                <div class="input-field col s12 m12 busqueda">
                                                    <input class="filtro" type="text" name="filtro" placeholder="NRO. MOVIMIENTO:">
                                                    <i class="material-icons prefix" style="margin-left:-25px;">search</i>
                                                </div>
                                            </div>
                                            <div class="row">
                                                <div class="input-field col s12 m6">
                                                    <input type="text" name="Id" id="Id" hidden />
                                                    <label for="cajadiario">Caja Diario:</label>
                                                    <input type="text" name="cajadiario" id="cajadiario" readonly />
                                                </div>
                                                <div class="input-field col s12 m6">
                                                    <label for="operacion">Operacion:</label>
                                                    <input type="text" name="operacion" id="operacion" readonly />
                                                </div>
                                                <div class="input-field col s12 m6">
                                                    <label for="alumno">Alumno:</label>
                                                    <input type="text" name="alumno" id="alumno" readonly />
                                                </div>
                                                <div class="input-field col s12 m6">
                                                    <label for="fechapago">Fecha Pago:</label>
                                                    <input type="text" name="fechapago" id="fechapago" readonly />
                                                </div>
                                                <div class="input-field col s12 m12">
                                                    <label for="importe">Importe Pago:</label>
                                                    <input type="text" name="importe" id="importe" readonly />
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="row">
    <p style="color:transparent">Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua.</p>
</div>

@section Scripts{
    <script type="text/javascript">
        $(document).ready(function () {
            $('.collapsible').collapsible();
            $('.modal').modal();
        });
    </script>
}

<script src="~/Scripts/jquery-3.4.1.min.js" type="text/javascript"></script>
<script>
    var asignarfunc = function () {
        var envio = {
            CajaId: $("#CajasDisponibles").val(),
            CajaDenominacion: $("#CajasDisponibles option:selected").text(),
            UsuarioId: $("#UsuariosDisponibles").val(),
            SaldoInicial: $("#inicial").val()
        }
        console.log(envio)
        $.ajax({
            url: '@Url.Action("AsignarCaja","CajaDiario")',
            data: JSON.stringify(envio),
            type: 'POST',
            async: false,//this makes the ajax-call blocking
            contentType: 'application/json;charset=UTF-8',
            dataType: 'json',
            success: function () {

            }
        });
    }

    var cerrarfunc = function () {

        var sumaTotal = 0;
        $(".Final").each(function () {
            sumaTotal += parseFloat($(this).text());
        });

        var envio = {
            SaldoFinal: sumaTotal
            //CajasAsignadas: _CajasAsignadas
        }
        console.log(envio)
        $.ajax({
            url: '@Url.Action("CerrarCajas","CajaDiario")',
            data: JSON.stringify(envio),
            type: 'PATCH',
            async: false,//this makes the ajax-call blocking
            contentType: 'application/json;charset=UTF-8',
            dataType: 'json',
            success: function () {
                $("#tbd_Asignadas").remove();
                $(".tdFalse").html("SI");
                $(".tdFalse").attr("class","");
            }
        });

    }

    $(document).ready(function () {
        $("#asignar").click(asignarfunc);
        $("#cerrar").click(cerrarfunc);

        if ($("#tbd_Asignadas").length > 1) {
            $("#cerrar_caja").prop('disabled', false);
        }
        

    });
</script>